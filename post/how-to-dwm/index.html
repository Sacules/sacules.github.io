<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>How to dwm :: kernelashes — Ramblings and handy guides on oddly-specific stuff</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://sacules.github.io/post/how-to-dwm/" />


<link rel="stylesheet" href="/assets/style.css">
<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Source+Code+Pro' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/assets/style.css">




<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="How to dwm :: kernelashes — Ramblings and handy guides on oddly-specific stuff" />
<meta name="twitter:description" content="My experience with dwm started as an interest in tiling window managers - had previously tried i3, but never got comfortable with the keybindings. When I found about the whole suckless project, the idea of a simpler WM that offered tiling and was very light made me interested in trying it on an older netbook I had.
Since I had no clue on how to patch it, found an interesting fork on github that had some patches I was interested in." />
<meta name="twitter:site" content="" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image" content="https://sacules.github.io/img/post/dwm.png">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="How to dwm :: kernelashes — Ramblings and handy guides on oddly-specific stuff">
<meta property="og:description" content="" />
<meta property="og:url" content="https://sacules.github.io/post/how-to-dwm/" />
<meta property="og:site_name" content="How to dwm" />
<meta property="og:image" content="https://sacules.github.io/img/post/dwm.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="article:section" content="Linux" />
<meta property="article:published_time" content="2018-08-05 03:00:42 -0300 -03" />







</head>
<body class="dark-theme">
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="https://sacules.github.io/" style="text-decoration: none;">
  <div class="logo">
    
      <span class="logo__mark">></span>
      <span class="logo__text">kernel_ashes</span>
      <span class="logo__cursor"></span>
    
  </div>
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner">
    
      <li><a href="/linux">Linux</a></li>
    
      <li><a href="/about/">About</a></li>
    
  </ul>
</nav>
        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>        
        </span>
      
      <span class="theme-toggle">
        <svg class="bulb-off" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect width="24" height="24"/>
  <path d="M4 19C4 19.55 4.45 20 5 20H9C9.55 20 10 19.55 10 19V18H4V19ZM7 0C3.14 0 0 3.14 0 7C0 9.38 1.19 11.47 3 12.74V15C3 15.55 3.45 16 4 16H10C10.55 16 11 15.55 11 15V12.74C12.81 11.47 14 9.38 14 7C14 3.14 10.86 0 7 0ZM9.85 11.1L9 11.7V14H5V11.7L4.15 11.1C2.8 10.16 2 8.63 2 7C2 4.24 4.24 2 7 2C9.76 2 12 4.24 12 7C12 8.63 11.2 10.16 9.85 11.1Z" transform="translate(5 2)" fill="black"/>
</svg>

<svg class="bulb-on" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <rect width="24" height="24"/>
  <path class="bulb-on__base" d="M4 19C4 19.55 4.45 20 5 20H9C9.55 20 10 19.55 10 19V18H4V19Z" transform="translate(5 2)" fill="#a9a9b3" />
  <path class="bulb-on__glass" d="M0 7C0 3.14 3.14 0 7 0C10.86 0 14 3.14 14 7C14 9.38 12.81 11.47 11 12.74V15C11 15.55 10.55 16 10 16H4C3.45 16 3 15.55 3 15V12.74C1.19 11.47 0 9.38 0 7Z" transform="translate(5 2)" fill="#a9a9b3" />
</svg>
  
      </span>
    </span>
  </span>
</header>


  <div class="content">
    
  <div class="post">
    <h2 class="post-title"><a href="https://sacules.github.io/post/how-to-dwm/">How to dwm</a></h2>
    <div class="post-meta">
      <span class="post-date">
        2018-08-05
      </span>
      <span class="post-author">Written by Sacules</span>
    </div>

    
      <span class="post-tags">
        
          #<a href="https://sacules.github.io/tags/suckless">Suckless</a>&nbsp;
        
          #<a href="https://sacules.github.io/tags/ricing">Ricing</a>&nbsp;
        
      </span>
    

    
      <img src="/img/dwm.png" class="post-cover" />
    

    <div class="post-content">
      

<p>My experience with dwm started as an interest in tiling window managers - had previously tried i3, but never got comfortable with the keybindings. When I found about the whole suckless project, the idea of a simpler WM that offered tiling and was very light made me interested in trying it on an older netbook I had.</p>

<p>Since I had no clue on how to patch it, found an interesting fork on github that had some patches I was interested in. Some months later I got tired of it and chose to go all the way to patching dwm myself, and getting the settings I wanted.</p>

<p>And there came the idea of documenting the process, albeit a little late, but better now before I forget the details. The following is a rough guide to patching and customizing dwm, and how to deal with some of the minor details. For a beginner&rsquo;s guide on how to use dwm, see the excellent <a href="http://ratfactor.com/slackware/dwm/">Dave&rsquo;s Visual Guide to dwm</a>.</p>

<p><strong>Notice</strong>: I&rsquo;m using the git version of dwm, which is slightly different and I recommend above the stable versions since it has several fixes.</p>

<p>I&rsquo;ve applied the following patches:</p>

<ul>
<li>Tilegap</li>
<li>Statuscolors</li>
<li>Systray</li>
<li>Scratchpad</li>
<li>Pertag</li>
<li>Cfacts</li>
<li>Bottomstack layout (with custom gaps)</li>
<li>Attachaside</li>
<li>Clear layout</li>
<li>Status bar padding</li>
</ul>

<h1 id="colors">Colors</h1>

<p>The easiest part: colors are defined as strings, using an RGB format, and are arrays of characters.</p>

<pre><code class="language-c">static const char normbordercolor[] = &quot;#393f45&quot;;
</code></pre>

<p>The name doesn&rsquo;t matter, and you can have a many colors defined as you like. What&rsquo;s important is where you put them on the colors array:</p>

<pre><code class="language-c">static const char *colors[][3]      = {
	/*               fg         bg         border   */
    [SchemeNorm] = { normfgcolor,   normbgcolor,   normbordercolor, },
    [SchemeSel]  = { selfgcolor,    selbgcolor,    selbordercolor , },
	[SchemeUrg] =  { urgfgcolor,    urgbgcolor,    urgbordercolor },
};
</code></pre>

<p>Let me explain what each of these means:</p>

<ul>
<li><code>[SchemeNorm]</code> holds the colors used for the inactive windows and tags, <code>fg</code> being the color of words or icons that define each tag, <code>bg</code>the background of each, and <code>border</code> the one for inactive windows.</li>
<li><code>[SchemeSel]</code>, same idea as before, but for selected windows and tags. In my config I&rsquo;ve set the background of both to be the same and only change the foreground color.</li>
<li><code>[SchemeUrg]</code> is an interesting scheme, used for notifications and warnings - for example, having Firefox open in one tag, and in another tag I open a link, the tag containing Rirefox will change its colors.</li>
</ul>

<p>For the sake of consistency, I stick to the colorscheme of my terminal (at the time of writing this, base16 Ashes).</p>

<h1 id="fonts">Fonts</h1>

<p>dwm has this very cool feature called <strong>font fallback</strong> which allows you to define several fonts, and if the first one can&rsquo;t display a character correctly, then dwm will try to  use the following font, and so on. This could be useful if you have a font that doesn&rsquo;t support glyphs or unicode characters, but still want to be able to display them.</p>

<pre><code class="language-c">static const char *fonts[] = { &quot;SauceCodePro Nerd Font:size=9:width=1&quot; };
</code></pre>

<p>I&rsquo;ve also seen that some people have had performance issues with some of the <a href="link">Nerd Fonts</a>, and this method has allowed them to prevent that. Haven&rsquo;t had such problems so ended up putting just one font.</p>

<h1 id="tags">Tags</h1>

<p>Similarly to the concept of several workspaces, dwm incorporates tags, which are like tabs were you can put your windows in. What&rsquo;s interesting tho, is the ability of combining several of these tags - that is, displaying the windows of several at once. By default, they&rsquo;re named from 1 to 9, but you can change that for any text or unicode icon you like - I think there&rsquo;s no minimum beyond 1 tag, but I&rsquo;m not sure if there&rsquo;s a limit of how many dwm can deal with.</p>

<pre><code class="language-c">static const char *tags[] = { &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot; };
</code></pre>

<h1 id="rules">Rules</h1>

<p>We can also define how certain programs will behave - this is handy to quickly set up the ones we use a lot, and be certain that, for example, Firefox will always open on the fourth tag of our third monitor and will always be floating no matter what.</p>

<pre><code class="language-c">static const Rule rules[] = {
	/* xprop(1):
	 *	WM_CLASS(STRING) = instance, class
	 *	WM_NAME(STRING) = title
	 */
	/* class      instance    title       tags mask     isfloating   monitor */
	{ &quot;Gimp&quot;,     NULL,       NULL,       0,            1,           -1 },
	{ &quot;Firefox&quot;,  NULL,       NULL,       0,       		0,           -1 },
};
</code></pre>

<p>A far more detailed explanation of how rules work can be found <a href="https://dwm.suckless.org/customisation/rules/">here</a>.</p>

<h1 id="layouts">Layouts</h1>

<p>This is just a list of all the layouts we have installed, the first three the default ones dwm includes, and the rest, the ones we can add by patching. Since they&rsquo;re represented with a string, we can change that to a nice unicode character like I&rsquo;ve done here.</p>

<pre><code class="language-c">static const Layout layouts[] = {
	/* symbol       arrange function */
	{ &quot;ﴳ&quot;,      tile },    /* first entry is default */
	{ &quot;缾&quot;,      NULL },    /* no layout function means floating behavior */
	{ &quot;类&quot;,      monocle },
	{ &quot;ﰀ&quot;,      bstack },
	{ &quot;&quot;,      bstackhoriz },
    { &quot;&quot;,      clean },
};
</code></pre>

<h1 id="keybindings-and-custom-commands">Keybindings and custom commands</h1>

<p>Before going into patching, I&rsquo;ll describe one of the most powerful customizations: keybindings. dwm can launch applications and use shell commands, and understanding how to add your own besides the default ones goes a long way to boost your <del>laziness</del> productivity.</p>

<p>First, let&rsquo;s take a quick glance at the <code>MODKEY</code> thing that&rsquo;s defined here:</p>

<pre><code class="language-c">#define MODKEY Mod1Mask
</code></pre>

<p>This is basically the main key when using dwm, over which we append others - for example, <code>MODKEY + i</code> moves the focus to another window, <code>MODKEY + f</code> changes the layout to floating, etc. This particular <code>MODKEY</code> is mapped to <code>Mod1</code>, which is the left <code>Alt</code> key. Since this one is often used by many programs, I changed it to the Windows key on my keyboard, which is <code>Mod4</code>.</p>

<p>Now, let&rsquo;s dig at adding commands: we define our command as a pointer to a static array of strings, giving each flag and parameter it&rsquo;s own place. Finally, we add <code>NULL</code> at the end to indicate that there are no more commands left. As an example, I&rsquo;ve created this to take screenshots.</p>

<pre><code class="language-c">static const char *scrotcmd[] = { &quot;scrot&quot;, &quot;--exec&quot;, &quot;mv -v $f ~/Pictures/Screenshots/&quot;, NULL };
</code></pre>

<p>Note that the third option here is a single parameter that you give to <code>scrot</code>, so it&rsquo;d normally look like this on the command line:</p>

<pre><code class="language-console">$ scrot --exec 'mv -v $f ~/Pictures/Screenshots/'
</code></pre>

<p>Then, to be able to assign a keybinding to this new command, we go to the keys array, and at the bottom, we can add our own:</p>

<pre><code class="language-c">static Key keys[] = {
	/* modifier            key           function    argument */
	{ MODKEY,              XK_p,         spawn,      {.v = dmenucmd } },
	{ MODKEY|ShiftMask,    XK_Return,    spawn,      {.v = termcmd } },
    ...
    /* custom */
	{ False,               XK_Print,     spawn,      {.v = scrotcmd } },
</code></pre>

<p>A quick explanation of what&rsquo;s going on here:</p>

<ul>
<li>In the first column we have to tell dwm if we&rsquo;re using a modifier key plus another key like <code>Ctrl</code> or <code>Shift</code>. In our case we don&rsquo;t need any so we&rsquo;ll leave it as <code>False</code>.</li>
<li>The following column is the actual key we want to press, in our case the <code>Imp Pnt</code> one. you can find a complete list of keys <a href="http://docs.piston.rs/mush/x11/keysym/">here</a>.</li>
<li><code>function</code> calls one of dwm&rsquo;s functions, we&rsquo;re interested in the <code>spawn</code> one since it&rsquo;s used for shell commands.</li>
<li>Lastly, we have to say what our command is! I&rsquo;ve got no clue of what the syntax exactly means on this case, so just go with <code>{.v = yourcommand }</code>.</li>
</ul>

<p>And that&rsquo;s pretty much it! But wait, what if I want to use those fancy buttons to lower/raise volume? Those keys are covered with another library, which we need to import at the beginning of our config:</p>

<pre><code class="language-c">#include &lt;X11/XF86keysym.h&gt;
</code></pre>

<p>I use the following commands to adjust volume:</p>

<pre><code class="language-c">static const char *volupcmd[] = { &quot;amixer&quot;, &quot;-q&quot;, &quot;set&quot;, &quot;Master&quot;, &quot;5%+&quot;, NULL };
static const char *voldncmd[] = { &quot;amixer&quot;, &quot;-q&quot;, &quot;set&quot;, &quot;Master&quot;, &quot;5%-&quot;, NULL };
</code></pre>

<p>Now, when adding a keybinding, notice the different naming for they key:</p>

<pre><code class="language-c">{ False,    XF86XK_AudioRaiseVolume,    spawn,    {.v = volupcmd } },
{ False,    XF86XK_AudioLowerVolume,    spawn,    {.v = voldncmd } },
</code></pre>

<p>You can find more media keys <a href="http://docs.piston.rs/piston_window/x11_dl/keysym/index.html">here</a>.</p>

<p>To finish this section, there&rsquo;s a part in the config about adding bindings to mouse buttons but I haven&rsquo;t got use for that so I can&rsquo;t guide you there.</p>

<h1 id="patches">Patches</h1>

<p>This is one if the most interesting parts about the suckless project but also what detracts others away from their software: they implement the bare, minimum functionality in a very compact and simple way, and to add more, you have to use patches. These are usually made and mantained by the community and add plenty of interesting twists to the usual workflow. Many fear this approach due to potential conflicts, and they&rsquo;re partly right, but solving these is trivial in most cases I&rsquo;ve encountered. I&rsquo;ll quickly show how to add some simple patches and how to deal with conflicts.</p>

<p>Let&rsquo;s begin with a simple patch, let&rsquo;s say you want to add the <strong>pertag</strong> patch. You simply do:</p>

<pre><code class="language-console">$ patch -p1 &lt; dwm-pertag-20170513-ceac8c9.diff
patching file dwm.c
Hunk #1 succeeded at 111 (offset -1 lines).
Hunk #2 succeeded at 131 (offset -1 lines).
Hunk #3 succeeded at 273 (offset -1 lines).
Hunk #4 succeeded at 642 (offset -1 lines).
Hunk #5 succeeded at 653 (offset -1 lines).
Hunk #6 succeeded at 992 (offset -2 lines).
Hunk #7 succeeded at 1527 (offset -2 lines).
Hunk #8 succeeded at 1548 (offset -2 lines).
Hunk #9 succeeded at 1725 (offset -2 lines).
Hunk #10 succeeded at 1764 (offset -2 lines).
Hunk #11 succeeded at 2085 (offset -1 lines).
</code></pre>

<p>Easy and smooth! Now recompile dwm and you&rsquo;re ready to go. You&rsquo;ll see a new file was generated called <code>dwm.c.orig</code> - this is the original file from before we applied the patch. If everything works fine, you can safely delete it.</p>

<p>Let&rsquo;s try to add more patches, say, new layouts like <strong>fibonacci</strong> and <strong>bottomstack</strong>. As before, we do:</p>

<pre><code class="language-console">$ patch -p1 &lt; dwm-fibonacci-5.8.2.diff
patching file config.def.h
Hunk #1 succeeded at 39 (offset 10 lines).
Hunk #2 succeeded at 45 (offset 10 lines).
patching file fibonacci.c

$ patch -p1 &lt; dwm-bottomstack-20160719-56a31dc.diff
patching file config.def.h
Hunk #1 FAILED at 41.
Hunk #2 succeeded at 79 (offset 3 lines).
1 out of 2 hunks FAILED -- saving rejects to file config.def.h.rej
patching file dwm.c
Hunk #1 succeeded at 235 (offset 1 line).
Hunk #2 succeeded at 2225 (offset 85 lines).
</code></pre>

<p>Don&rsquo;t panic, this is usual - let&rsquo;s check what specific changes couldn&rsquo;t be applied. Checking the <code>config.def.h.rej</code> file we can see:</p>

<pre><code class="language-diff">--- config.def.h
+++ config.def.h
@@ -41,6 +41,8 @@ static const Layout layouts[] = {
 	{ &quot;[]=&quot;,      tile },    /* first entry is default */
 	{ &quot;&gt;&lt;&gt;&quot;,      NULL },    /* no layout function means floating behavior */
 	{ &quot;[M]&quot;,      monocle },
+	{ &quot;TTT&quot;,      bstack },
+	{ &quot;===&quot;,      bstackhoriz },
 };
 
 /* key definitions */
</code></pre>

<p>The conflicts come from the patch expecting your code to look <em>exactly</em> like this, so let&rsquo;s see how that part of <code>config.def.h</code> actually looks like:</p>

<pre><code class="language-c">    { &quot;[]=&quot;,      tile },    /* first entry is default */
	{ &quot;&gt;&lt;&gt;&quot;,      NULL },    /* no layout function means floating behavior */
	{ &quot;[M]&quot;,      monocle },
 	{ &quot;[@]&quot;,      spiral },
 	{ &quot;[\\]&quot;,      dwindle },
};

/* key definitions */
</code></pre>

<p>Now it&rsquo;s obvious - it didn&rsquo;t expect those those new layouts we added before since the patch was probably made on a vanilla dwm. This is an easy fix, as we just need to paste the layouts we wanted to add, so it looks like this:</p>

<pre><code class="language-c">    { &quot;[]=&quot;,      tile },    /* first entry is default */
	{ &quot;&gt;&lt;&gt;&quot;,      NULL },    /* no layout function means floating behavior */
	{ &quot;[M]&quot;,      monocle },
    { &quot;TTT&quot;,      bstack },
	{ &quot;===&quot;,      bstackhoriz },
 	{ &quot;[@]&quot;,      spiral },
 	{ &quot;[\\]&quot;,      dwindle },
};

/* key definitions */
</code></pre>

<p>And that&rsquo;s pretty much the source of 90% of patch conflicts. There are some other weird cases that might pop up if you have some specific patches that want to modify a common part of the code for, say, drawing the status bar. And those are the tough ones if you are not familiar with C.</p>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <a class="btn next" href="https://sacules.github.io/post/void-journey-i/">← Void Linux Journey, Part I: Automounting</a>
          
           
        </div>
      </div>
    
  </div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="https://sacules.github.io/" style="text-decoration: none;">
  <div class="logo">
    
      <span class="logo__mark">></span>
      <span class="logo__text">kernel_ashes</span>
      <span class="logo__cursor"></span>
    
  </div>
</a>

      <div class="copyright">
        <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr">panr</a> 2018</span>
      </div>
    
  </div>
</footer>


  <script src="/assets/main.js"></script>

  <script src="/assets/prism.js"></script>



  
</div>

</body>
</html>
